<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gladiator | Pro Dashboard</title>
    <link rel="icon" type="image/webp" href="https://raw.githubusercontent.com/Kronborg1980/Gladiator-Collectables/main/logogla.webp">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #000000;
            --panel: #0d0d0d;
            --gold: #ffda6a;
            --gold-glow: #D4AF37;
            --border: #333;
        }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: #e0e0e0;
            height: 100vh;
            overflow: hidden;
        }
        .big-input {
            @apply bg-black/50 border border-[#333] rounded-lg px-4 py-3 text-lg font-medium text-white outline-none transition;
        }
        .big-input:focus {
            @apply border-[#ffda6a] shadow-lg shadow-[#ffda6a]/20;
        }
        .gold-btn {
            @apply bg-gradient-to-r from-[#ffda6a] to-[#D4AF37] text-black font-black uppercase tracking-wider rounded-lg shadow-xl hover:shadow-2xl hover:shadow-[#ffda6a]/40 transform hover:scale-105 transition-all duration-200;
        }
        .card-hover {
            @apply hover:border-[#ffda6a] hover:shadow-2xl hover:shadow-[#ffda6a]/30 transform hover:-translate-y-2 transition-all duration-300;
        }
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #000; }
        }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--gold); }
        [v-cloak] { display: none; }
    </style>
</head>
<body class="flex flex-col h-screen">

<div id="app" v-cloak class="flex flex-col h-full">

    <!-- HEADER -->
    <div class="h-20 bg-gradient-to-b from-[#111] to-black border-b-4 border-[#ffda6a]/30 flex items-center justify-between px-8 shadow-2xl">
        <div class="flex items-center gap-6">
            <img src="https://raw.githubusercontent.com/Kronborg1980/Gladiator-Collectables/main/logogla.webp" class="h-14 drop-shadow-2xl">
            <div>
                <h1 class="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-[#ffda6a] to-[#D4AF37] tracking-widest">GLADIATOR</h1>
                <p class="text-sm text-gray-500 -mt-1">PRO ARMORY</p>
            </div>
        </div>
        <div class="flex items-center gap-12 text-2xl font-bold">
            <div>ASSETS: <span class="text-white">{{ cards.length }}</span></div>
            <div>COST: <span class="text-cyan-400">${{ formatNumber(totalCost) }}</span></div>
            <div>PROFIT: <span :class="totalProfit >= 0 ? 'text-green-400' : 'text-red-500'">${{ formatNumber(totalProfit) }}</span></div>
        </div>
    </div>

    <!-- TOOLBAR -->
    <div class="p-6 bg-[#050505] border-b border-[#333] flex flex-wrap gap-6 items-center">
        <div class="relative">
            <i class="fa-solid fa-search absolute left-5 top-5 text-gray-500 text-xl"></i>
            <input v-model="filter" placeholder="FILTER COLLECTION..." class="pl-14 big-input w-96">
        </div>
        <div class="flex gap-4">
            <button @click="updatePrices" :disabled="isUpdating" class="px-8 py-4 gold-btn text-xl"><i class="fa-solid fa-arrows-rotate" :class="{'animate-spin': isUpdating}"></i> UPDATE PRICES</button>
            <button @click="exportExcel" class="px-8 py-4 bg-gradient-to-r from-green-600 to-green-500 text-white font-bold rounded-lg shadow-lg hover:shadow-green-500/50">EXCEL</button>
            <button @click="backup" class="px-8 py-4 bg-gradient-to-r from-blue-600 to-blue-500 text-white font-bold rounded-lg shadow-lg">BACKUP</button>
            <label class="px-8 py-4 bg-gradient-to-r from-purple-600 to-purple-500 text-white font-bold rounded-lg shadow-lg cursor-pointer">RESTORE <input type="file" @change="restore" class="hidden"></label>
        </div>
        <div class="flex-1"></div>
        <button @click="openSearch" class="px-12 py-5 gold-btn text-2xl shadow-2xl"><i class="fa-solid fa-plus mr-3"></i> ADD ASSET</button>
    </div>

    <!-- DESKTOP TABLE -->
    <div class="flex-1 overflow-auto bg-black">
        <table class="w-full text-left">
            <thead class="sticky top-0 bg-black border-b-4 border-[#ffda6a]/40 text-yellow-500 text-xl uppercase tracking-widest h-20">
                <tr>
                    <th class="pl-8"></th>
                    <th class="px-6">CARD</th>
                    <th class="px-6">SET</th>
                    <th class="px-6">COND</th>
                    <th class="px-6 text-right">RAW</th>
                    <th class="px-6 text-right">FEE</th>
                    <th class="px-6 text-center text-[#ffda6a]">TARGET</th>
                    <th class="px-6 text-right text-white">VALUE</th>
                    <th class="px-6 text-right">PROFIT</th>
                    <th class="px-6"></th>
                    <th></th>
                </tr>
            </thead>
            <tbody class="text-lg">
                <tr v-for="(c,i) in filteredCards" :key="i" class="h-24 border-b border-[#222] hover:bg-[#111] card-hover group">
                    <td class="pl-8">
                        <img :src="c.img" class="h-20 w-14 object-cover rounded-lg border-2 border-[#333] group-hover:border-[#ffda6a] transition">
                    </td>
                    <td class="px-6 font-bold text-white max-w-md truncate" :title="c.name">{{ c.name }}</td>
                    <td class="px-6 text-gray-400">{{ c.set }}</td>
                    <td class="px-6"><input v-model="c.condition" class="big-input w-32 text-center"></td>
                    <td class="px-6 text-right font-mono"><input v-model.number="c.raw" type="number" class="bg-transparent text-right w-32"></td>
                    <td class="px-6 text-right font-mono"><input v-model.number="c.fee" type="number" class="bg-transparent text-right w-24"></td>
                    <td class="px-6 text-center">
                        <select v-model="c.target" class="bg-black/70 text-[#ffda6a] font-black text-2xl w-20 mx-auto rounded border border-[#444]">
                            <option value="10">10</option><option value="9">9</option><option value="8">8</option>
                        </select>
                    </td>
                    <td class="px-6 text-right font-black text-white text-2xl"><input :value="getValue(c)" @input="updateValue(c,$event.target.value)" class="bg-gradient-to-r from-cyan-500/20 to-transparent text-right w-40 px-3 rounded"></td>
                    <td class="px-6 text-right font-black text-3xl" :class="getProfit(c)>=0?'text-[#ffda6a]':'text-red-500'">${{ Math.round(getProfit(c)).toLocaleString() }}</td>
                    <td class="px-6 text-center text-3xl">
                        <i v-if="getProfit(c)>0" class="text-green-500 fa-solid fa-trophy"></i>
                        <i v-else class="text-red-600 fa-solid fa-bomb"></i>
                    </td>
                    <td class="pr-8"><button @click="remove(i)" class="text-red-500 hover:text-red-400 text-2xl"><i class="fa-solid fa-trash-can"></i></button></td>
                </tr>
            </tbody>
        </table>
        <div v-if="cards.length===0" class="h-full flex items-center justify-center">
            <div class="text-6xl font-black text-gray-800 uppercase opacity-20">EMPTY ARMORY</div>
        </div>
    </div>

    <!-- SEARCH MODAL â€” BIG & BEAUTIFUL -->
    <div v-if="showSearch" class="fixed inset-0 bg-black/95 backdrop-blur-xl flex items-center justify-center z-50 p-8">
        <div class="w-full max-w-6xl bg-gradient-to-b from-[#111] to-black border-4 border-[#ffda6a]/40 rounded-2xl shadow-4xl overflow-hidden">
            <div class="p-8 border-b-4 border-[#ffda6a]/20 flex justify-between items-center">
                <h2 class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-[#ffda6a] to-[#D4AF37]">ADD NEW ASSET</h2>
                <button @click="showSearch=false" class="text-4xl text-gray-500 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
            </div>

            <div class="p-8 flex gap-8 items-center">
                <div class="relative flex-1">
                    <input v-model="setQuery" @input="searchSets" placeholder="Type set name set..." class="w-full big-input text-2xl py-5 pl-16">
                    <i class="fa-solid fa-magnifying-glass absolute left-6 top-7 text-gray-500 text-2xl"></i>
                    <div v-if="setSuggestions.length" class="absolute top-full left-0 right-0 bg-black border-2 border-[#ffda6a]/50 max-h-64 overflow-y-auto z-10 rounded-b-xl">
                        <div v-for="s in setSuggestions" @click="pickSet(s)" class="px-8 py-4 hover:bg-[#222] cursor-pointer text-xl">{{ s.name }}</div>
                    </div>
                </div>

                <input v-model="cardQuery" ref="searchBox" @keyup.enter="search" placeholder="Card name..." class="flex-1 big-input text-2xl py-5">

                <button @click="search" class="px-20 py-6 gold-btn text-3xl shadow-2xl">SEARCH</button>
            </div>

            <div class="p-8 max-h-96 overflow-y-auto">
                <div v-if="loading" class="text-center py-20 text-6xl text-[#ffda6a]"><i class="fa-solid fa-circle-notch fa-spin"></i></div>
                <div v-else-if="results.length" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6">
                    <div v-for="c in results" @click="add(c)" class="bg-[#111] rounded-2xl overflow-hidden card-hover cursor-pointer border-4 border-[#333]">
                        <div class="relative">
                            <img :src="c.images.large || c.images.small" class="w-full">
                            <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black via-transparent to-transparent p-6 text-right">
                                <div class="text-4xl font-black text-[#ffda6a] drop-shadow-2xl">${{ c.price || '???' }}</div>
                            </div>
                        </div>
                        <div class="p-4 text-center">
                            <div class="font-bold text-xl text-white truncate">{{ c.name }}</div>
                            <div class="text-gray-500 text-lg">{{ c.set.name }} #{{ c.number }}</div>
                        </div>
                    </div>
                </div>
                <div v-else-if="hasSearched" class="text-center py-20 text-4xl text-gray-600">No cards found</div>
            </div>
        </div>
    </div>
</div>

<script>
const { createApp } = Vue;
createApp({
    data() { return {
        cards: [], filter: '', showSearch: false, cardQuery: '', setQuery: '',
        results: [], loading: false, setSuggestions: [], selectedSetId: '', hasSearched: false, isUpdating: false
    }},
    mounted() {
        const s = localStorage.getItem('gladiator_big');
        if (s) this.cards = JSON.parse(s);
    },
    computed: {
        filteredCards() {
            if (!this.filter) return this.cards;
            const q = this.filter.toLowerCase();
            return this.cards.filter(c => c.name.toLowerCase().includes(q) || c.set.toLowerCase().includes(q));
        },
        totalCost() { return this.cards.reduce((a,c) => a + (c.raw||0) + (c.fee||0), 0); },
        totalProfit() { return this.cards.reduce((a,c) => a + this.getProfit(c), 0); }
    },
    methods: {
        formatNumber(n) { return Math.round(n||0).toLocaleString(); },
        save() { localStorage.setItem('gladiator_big', JSON.stringify(this.cards)); },
        getValue(c) { return c.target==10 ? c.psa10||0 : c.target==9 c.psa9||0 : c.psa8||0; },
        updateValue(c,v) {
            const val = parseFloat(v)||0;
            if(c.target==10) c.psa10=val; else if(c.target==9) c.psa9=val; else c.psa8=val;
            this.save();
        },
        getProfit(c) { return this.getValue(c) - (c.raw||0) - (c.fee||0); },

        async searchSets() {
            if (this.setQuery.length < 2) { this.setSuggestions = []; return; }
            const r = await fetch(`https://api.pokemontcg.io/v2/sets?q=name:*${this.setQuery}*`);
            const j = await r.json();
            this.setSuggestions = j.data.slice(0,10);
        },
        pickSet(s) {
            this.setQuery = s.name; this.selectedSetId = s.id; this.setSuggestions = [];
            this.$refs.searchBox.focus();
        },
        async search() {
            if (!this.cardQuery.trim()) return;
            this.loading = true; this.hasSearched = true; this.results = [];
            let url = `https://api.pokemontcg.io/v2/cards?q=name:*${encodeURIComponent(this.cardQuery)}*`;
            if (this.selectedSetId) url += `+set.id:${this.selectedSetId}`;
            url += `&pageSize=60&orderBy=number`;
            const r = await fetch(url);
            const j = await r.json();
            this.results = (j.data||[]).map(c=>({
                ...c,
                price: c.tcgplayer?.prices?.holofoil?.market || c.tcgplayer?.prices?.normal?.market || c.tcgplayer?.prices?.reverseHolofoil?.market || 0
            }));
            this.loading = false;
        },
        add(c) {
            const p = c.price || 0;
            this.cards.push({
                id: c.id, name: c.name, set: c.set.name, img: c.images.small,
                raw: p, fee: 15, target: 10,
                psa10: +(p*3.2).toFixed(2), psa9: +(p*1.1).toFixed(2), psa8: +(p*0.85).toFixed(2)
            });
            this.save(); this.showSearch = false;
        },
        remove(i) { if(confirm('Delete?')) { this.cards.splice(i,1); this.save(); }},

        async updatePrices() {
            this.isUpdating = true;
            // same fast chunked update as before
            const ids = this.cards.filter(c=>c.id).map(c=>c.id);
            const chunk = 20;
            for(let i=0;i<ids.length;i+=chunk){
                const q = ids.slice(i,i+chunk).map(id=>`id:${id}`).join(' OR ');
                const r = await fetch(`https://api.pokemontcg.io/v2/cards?q=${q}`);
                const j = await r.json();
                j.data.forEach(api=>{
                    const card = this.cards.find(c=>c.id===api.id);
                    if(card){
                        const p = api.tcgplayer?.prices;
                        const price = p?.holofoil?.market || p?.normal?.market || p?.reverseHolofoil?.market || card.raw;
                        card.raw = price;
                        card.psa10 = +(price*3.2).toFixed(2);
                        card.psa9 = +(price*1.1).toFixed(2);
                        card.psa8 = +(price*0.85).toFixed(2);
                    }
                });
            }
            this.save(); this.isUpdating = false; alert('Prices updated!');
        },

        exportExcel() {
            const data = this.cards.map(c=>({Card:c.name,Set:c.set,Raw:c.raw,Fee:c.fee,Target:c.target,Value:this.getValue(c),Profit:this.getProfit(c)}));
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Gladiator");
            XLSX.writeFile(wb, "Gladiator_Export.xlsx");
        },
        backup() {
            const a = document.createElement('a');
            a.href = URL.createObjectURL(new Blob([JSON.stringify(this.cards)],{type:'application/json'}));
            a.download = 'gladiator_backup.json'; a.click();
        },
        restore(e) {
            const f = e.target.files[0];
            if(!f) return;
            const r = new FileReader();
            r.onload = ev => { this.cards = JSON.parse(ev.target.result); this.save(); };
            r.readAsText(f);
        },
        openSearch() {
            this.showSearch = true; this.cardQuery = ''; this.setQuery = ''; this.selectedSetId = '';
            this.results = []; this.hasSearched = false;
            this.$nextTick(()=>this.$refs.searchBox?.focus());
        }
    }
}).mount('#app');
</script>
</body>
</html>

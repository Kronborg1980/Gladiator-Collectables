<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gladiator Collectables | Official Dashboard</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700;900&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        /* --- THEME CONFIGURATION --- */
        :root {
            --bg-dark: #050505;
            --panel-bg: #111111;
            --gold: #D4AF37;       
            --gold-glow: #F2C94C;  
            --text-main: #e2e8f0;
            --border: #27272a;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(212, 175, 55, 0.08), transparent 25%), 
                radial-gradient(circle at 85% 30%, rgba(212, 175, 55, 0.05), transparent 25%);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden; 
        }

        /* TYPOGRAPHY */
        .font-brand { font-family: 'Cinzel', serif; }
        .text-gold { color: var(--gold); }
        .text-gold-gradient {
            background: linear-gradient(to right, #D4AF37, #F2C94C, #D4AF37);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* UI ELEMENTS */
        .glass-panel {
            background: rgba(18, 18, 18, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        /* INPUT FIELDS */
        .pro-input {
            background: transparent;
            border: 1px solid transparent;
            color: #ccc;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s ease;
            font-size: 0.75rem;
        }
        .pro-input:hover { background: rgba(255,255,255,0.05); border-color: #333; }
        .pro-input:focus {
            border-color: var(--gold);
            background: #000;
            outline: none;
            color: white;
        }
        .pro-input.number { font-family: 'Courier New', monospace; font-weight: 700; }

        /* CUSTOM SCROLLBAR */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--gold); }

        [v-cloak] { display: none; }
    </style>
</head>
<body class="p-4 md:p-6 flex flex-col h-screen">

<div id="app" v-cloak class="flex flex-col h-full w-full max-w-[1900px] mx-auto gap-6">
    
    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-end gap-6 shrink-0">
        
        <div class="flex items-center gap-5">
            <div class="w-20 h-20 bg-black rounded-xl border border-[#333] flex items-center justify-center shadow-[0_0_20px_rgba(212,175,55,0.15)] p-2">
                <img src="https://raw.githubusercontent.com/Kronborg1980/Gladiator-Collectables/main/logogla.webp" class="w-full h-full object-contain">
            </div>
            
            <div>
                <h1 class="text-3xl font-bold font-brand text-white tracking-wide uppercase">
                    Gladiator <span class="text-gold-gradient">Collectables</span>
                </h1>
                <p class="text-xs font-semibold tracking-[0.2em] text-slate-500 uppercase mt-1">Professional Grading Tracker</p>
            </div>
        </div>

        <div class="grid grid-cols-3 gap-3 w-full lg:w-auto">
            
            <div class="glass-panel rounded-lg p-3 w-full lg:w-40 border-l-2 border-slate-600">
                <div class="text-[10px] text-slate-500 uppercase tracking-widest font-bold mb-1">Inventory</div>
                <div class="text-2xl font-bold text-white">{{ cards.length }} <span class="text-[10px] font-normal text-slate-600">Items</span></div>
            </div>

            <div class="glass-panel rounded-lg p-3 w-full lg:w-40 border-l-2 border-blue-600/50">
                <div class="text-[10px] text-slate-500 uppercase tracking-widest font-bold mb-1">Total Cost</div>
                <div class="text-2xl font-bold text-blue-500">${{ formatNumber(totalCost) }}</div>
            </div>

            <div class="glass-panel rounded-lg p-3 w-full lg:w-48 border-l-2 border-[#D4AF37] relative overflow-hidden">
                <div class="absolute top-0 right-0 p-2 opacity-10"><i class="fa-solid fa-coins text-4xl text-[#D4AF37]"></i></div>
                <div class="text-[10px] text-slate-500 uppercase tracking-widest font-bold mb-1">Net Profit</div>
                <div class="text-2xl font-bold" :class="totalProfit >= 0 ? 'text-[#D4AF37]' : 'text-red-500'">
                    ${{ formatNumber(totalProfit) }}
                </div>
            </div>
        </div>
    </div>

    <div class="flex flex-wrap items-center justify-between gap-4 bg-[#111] p-2 rounded-lg border border-[#222] shrink-0">
        
        <div class="relative group w-full md:w-auto">
            <i class="fa-solid fa-filter absolute left-3 top-1/2 -translate-y-1/2 text-slate-600 group-focus-within:text-[#D4AF37] transition"></i>
            <input v-model="filter" placeholder="FILTER LIST..." 
                class="bg-black border border-[#333] text-white text-xs font-bold rounded pl-8 pr-3 py-2 w-full md:w-64 focus:border-[#D4AF37] outline-none transition-all uppercase placeholder-slate-700">
        </div>

        <div class="flex gap-2 w-full md:w-auto overflow-x-auto pb-1 md:pb-0">
            <button @click="exportExcel" class="flex items-center gap-2 px-4 py-2 bg-[#1a1a1a] hover:bg-[#222] text-slate-400 hover:text-green-500 text-[10px] font-bold uppercase rounded transition border border-[#333]">
                <i class="fa-solid fa-file-excel"></i> Excel
            </button>
            <button @click="exportPDF" class="flex items-center gap-2 px-4 py-2 bg-[#1a1a1a] hover:bg-[#222] text-slate-400 hover:text-red-500 text-[10px] font-bold uppercase rounded transition border border-[#333]">
                <i class="fa-solid fa-file-pdf"></i> PDF
            </button>
            <button @click="backup" class="flex items-center gap-2 px-4 py-2 bg-[#1a1a1a] hover:bg-[#222] text-slate-400 hover:text-blue-500 text-[10px] font-bold uppercase rounded transition border border-[#333]">
                <i class="fa-solid fa-download"></i> Save
            </button>
            <label class="flex items-center gap-2 px-4 py-2 bg-[#1a1a1a] hover:bg-[#222] text-slate-400 hover:text-purple-500 text-[10px] font-bold uppercase rounded transition border border-[#333] cursor-pointer">
                <i class="fa-solid fa-upload"></i> Load <input type="file" @change="restore" class="hidden">
            </label>
            
            <div class="w-[1px] bg-[#333] mx-2 h-8"></div>
            
            <button @click="openSearch" class="flex items-center gap-2 px-6 py-2 bg-[#D4AF37] hover:bg-white text-black text-xs font-bold uppercase rounded shadow-[0_0_15px_rgba(212,175,55,0.25)] hover:shadow-[0_0_20px_rgba(212,175,55,0.5)] transition transform active:scale-95 whitespace-nowrap">
                <i class="fa-solid fa-bolt"></i> New Asset
            </button>
        </div>
    </div>

    <div class="flex-1 glass-panel rounded-xl overflow-hidden relative flex flex-col shadow-2xl">
        <div class="overflow-auto flex-1">
            <table class="w-full text-left border-collapse min-w-[1400px]">
                <thead class="sticky top-0 z-10 bg-[#080808] shadow-md">
                    <tr class="text-[9px] text-slate-500 uppercase tracking-widest border-b border-[#333] h-10">
                        <th class="pl-4 w-12 text-center">Img</th>
                        <th class="px-2">Asset Details</th>
                        <th class="px-2 w-48">Condition Notes</th>
                        <th class="px-2 text-right w-24">Raw Price</th>
                        <th class="px-2 text-right w-24">Grade Fee</th>
                        <th class="px-2 text-center w-24">Exp. Grade</th>
                        
                        <th class="px-2 bg-[#0c0c0c] text-right w-24 border-l border-[#222] text-green-600">PSA 10</th>
                        <th class="px-2 bg-[#0c0c0c] text-right w-24 text-yellow-600">PSA 9</th>
                        <th class="px-2 bg-[#0c0c0c] text-right w-24 border-r border-[#222] text-red-600">PSA 8</th>

                        <th class="px-2 text-right w-28 text-[#D4AF37]">Net Profit</th>
                        <th class="px-2 text-center w-24">Decision</th>
                        <th class="px-2 w-20 text-center">Sent</th>
                        <th class="px-2 w-16 text-center">Owner</th>
                        <th class="px-2 w-12"></th>
                    </tr>
                </thead>
                <tbody class="text-xs divide-y divide-[#222]">
                    <tr v-for="(c, i) in filteredCards" :key="i" class="hover:bg-[#1a1a1a] group transition-colors">
                        
                        <td class="p-2 text-center">
                            <div class="w-8 h-11 mx-auto rounded border border-[#333] bg-black overflow-hidden relative group-hover:border-[#D4AF37] transition-colors">
                                <img v-if="c.img" :src="c.img" class="absolute inset-0 w-full h-full object-cover">
                            </div>
                        </td>

                        <td class="p-2">
                            <div class="font-bold text-slate-200 truncate w-40" :title="c.name">{{ c.name }}</div>
                            <div class="text-[9px] font-semibold text-slate-500 uppercase tracking-wide">{{ c.set }}</div>
                        </td>

                        <td class="p-1"><input v-model="c.condition" type="text" placeholder="e.g. Whitening..." class="pro-input w-full rounded px-2 py-1"></td>

                        <td class="p-1"><input v-model.number="c.raw" type="number" class="pro-input number w-full rounded px-2 py-1 text-right text-slate-300"></td>
                        <td class="p-1"><input v-model.number="c.fee" type="number" class="pro-input number w-full rounded px-2 py-1 text-right text-slate-400"></td>

                        <td class="p-1 text-center">
                            <select v-model="c.target" class="bg-transparent border border-transparent hover:border-[#333] text-[#D4AF37] font-bold text-[10px] py-1 px-2 rounded cursor-pointer outline-none text-center">
                                <option value="10">PSA 10</option>
                                <option value="9">PSA 9</option>
                                <option value="8">PSA 8</option>
                            </select>
                        </td>

                        <td class="p-1 border-l border-[#222] bg-[#0b0b0b]"><input v-model.number="c.psa10" type="number" class="pro-input number w-full rounded px-2 py-1 text-right text-green-500/80"></td>
                        <td class="p-1 bg-[#0b0b0b]"><input v-model.number="c.psa9" type="number" class="pro-input number w-full rounded px-2 py-1 text-right text-yellow-500/80"></td>
                        <td class="p-1 border-r border-[#222] bg-[#0b0b0b]"><input v-model.number="c.psa8" type="number" class="pro-input number w-full rounded px-2 py-1 text-right text-red-500/80"></td>

                        <td class="p-2 text-right font-mono font-bold text-sm">
                            <span :class="getProfit(c) >= 0 ? 'text-[#D4AF37]' : 'text-red-500'">
                                {{ getProfit(c) >= 0 ? '+' : '' }}{{ Math.round(getProfit(c)) }}
                            </span>
                        </td>

                        <td class="p-2 text-center">
                            <span v-if="getProfit(c) > 0" class="inline-flex items-center gap-1 bg-green-900/20 text-green-400 border border-green-800/50 px-2 py-0.5 rounded text-[9px] font-bold uppercase tracking-wider">
                                YES
                            </span>
                            <span v-else class="inline-flex items-center gap-1 bg-red-900/20 text-red-400 border border-red-800/50 px-2 py-0.5 rounded text-[9px] font-bold uppercase tracking-wider">
                                NO
                            </span>
                        </td>

                        <td class="p-1"><input v-model="c.sentDate" type="text" placeholder="-" class="pro-input w-full rounded px-1 py-1 text-center"></td>
                        <td class="p-1"><input v-model="c.owner" type="text" placeholder="-" class="pro-input w-full rounded px-1 py-1 text-center uppercase"></td>

                        <td class="p-2 text-center">
                            <button @click="remove(i)" class="text-slate-700 hover:text-red-500 transition opacity-0 group-hover:opacity-100"><i class="fa-solid fa-trash"></i></button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div v-if="cards.length === 0" class="absolute inset-0 flex items-center justify-center pointer-events-none">
            <div class="text-center">
                <div class="bg-[#1a1a1a] p-4 rounded-full inline-block mb-4 border border-[#333]">
                    <i class="fa-solid fa-scale-balanced text-4xl text-[#333]"></i>
                </div>
                <h3 class="text-slate-500 font-bold font-brand tracking-widest uppercase">Inventory Empty</h3>
                <p class="text-slate-600 text-xs mt-2">Add cards to begin analysis</p>
            </div>
        </div>
    </div>

    <div v-if="showSearch" class="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-start justify-center pt-20 z-50 p-4 transition-all">
        <div class="w-full max-w-4xl bg-[#0a0a0a] border border-[#333] rounded-2xl shadow-2xl flex flex-col max-h-[80vh] overflow-hidden animate-in fade-in zoom-in-95 duration-200">
            
            <div class="p-6 border-b border-[#222] bg-[#0f0f0f] relative flex items-center gap-4">
                <i class="fa-solid fa-search text-2xl text-slate-600"></i>
                <input ref="searchBox" v-model="query" 
                    placeholder="SEARCH DB (e.g. 'Gengar VMAX' or 'Charizard 151')..." 
                    class="w-full bg-transparent text-[#D4AF37] font-brand text-xl outline-none placeholder-slate-700 uppercase">
                <button @click="showSearch=false" class="text-slate-600 hover:text-white transition"><i class="fa-solid fa-xmark text-2xl"></i></button>
            </div>

            <div class="flex-1 overflow-y-auto p-6 bg-[#050505]">
                <div v-if="loading" class="flex flex-col items-center justify-center h-40">
                    <i class="fa-solid fa-circle-notch fa-spin text-3xl text-[#D4AF37] mb-3"></i>
                    <span class="text-xs uppercase tracking-widest text-slate-500">Scanning Database...</span>
                </div>

                <div v-else-if="results.length" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                    <div v-for="item in results" :key="item.id" @click="add(item)" 
                         class="group cursor-pointer bg-[#111] border border-[#222] p-3 rounded-xl hover:border-[#D4AF37] hover:bg-[#161616] transition-all relative overflow-hidden shadow-lg hover:-translate-y-1">
                        
                        <div class="aspect-[0.7] bg-black rounded-lg overflow-hidden border border-[#333] mb-3 relative">
                            <img :src="item.images.small" loading="lazy" class="w-full h-full object-cover">
                            <div class="absolute bottom-0 inset-x-0 bg-gradient-to-t from-black via-black/80 to-transparent p-2 pt-6">
                                <div class="text-[#D4AF37] font-mono font-bold text-center text-xs">${{ getPrice(item) }}</div>
                            </div>
                        </div>

                        <div class="text-center px-1">
                            <div class="text-xs font-bold text-slate-200 truncate group-hover:text-white">{{ item.name }}</div>
                            <div class="text-[9px] text-slate-500 uppercase tracking-widest truncate">{{ item.set.name }}</div>
                        </div>
                    </div>
                </div>

                <div v-else-if="query.length > 2" class="text-center py-20 text-slate-700">
                    <i class="fa-solid fa-ghost text-4xl mb-4 opacity-30"></i>
                    <p class="text-xs uppercase tracking-widest">No results found</p>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                cards: [], filter: '', showSearch: false, query: '', results: [], loading: false, timer: null
            }
        },
        mounted() {
            const db = localStorage.getItem('gladiator_v16');
            if(db) this.cards = JSON.parse(db);
        },
        computed: {
            filteredCards() {
                if(!this.filter) return this.cards;
                return this.cards.filter(c => c.name.toLowerCase().includes(this.filter.toLowerCase()));
            },
            totalCost() { return this.cards.reduce((sum, c) => sum + (c.raw || 0) + (c.fee || 0), 0); },
            totalProfit() { return this.cards.reduce((sum, c) => sum + this.getProfit(c), 0); }
        },
        watch: {
            query(val) {
                clearTimeout(this.timer);
                if(val.length < 3) { this.results = []; return; }
                this.loading = true;
                this.timer = setTimeout(() => this.fetchAPI(val), 600);
            }
        },
        methods: {
            formatNumber(n) { return (n||0).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2}); },
            save() { localStorage.setItem('gladiator_v16', JSON.stringify(this.cards)); },
            
            getProfit(c) {
                let val = (c.target == 10) ? c.psa10 : (c.target == 9 ? c.psa9 : c.psa8);
                return (val || 0) - ((c.raw || 0) + (c.fee || 0));
            },

            // SMART SEARCH
            async fetchAPI(input) {
                try {
                    const terms = input.trim().split(/\s+/);
                    const queryParts = terms.map(term => {
                        const t = term.replace(/[^a-zA-Z0-9]/g, '');
                        return `(name:"*${t}*" OR set.name:"*${t}*")`;
                    });
                    const queryString = queryParts.join(' ');
                    const url = `https://api.pokemontcg.io/v2/cards?q=${queryString}&orderBy=-set.releaseDate&pageSize=20`;

                    const res = await fetch(url);
                    const data = await res.json();
                    this.results = data.data || [];
                } catch(e) {} finally { this.loading = false; }
            },

            getPrice(item) {
                if(!item.tcgplayer?.prices) return 0;
                const p = item.tcgplayer.prices;
                return p.holofoil?.market || p.normal?.market || p.reverseHolofoil?.market || p.unlimitedHolofoil?.market || 0;
            },

            openSearch() { this.showSearch = true; this.query = ''; this.results = []; this.$nextTick(() => this.$refs.searchBox.focus()); },
            
            add(item) {
                const rawPrice = this.getPrice(item);
                const newCard = {
                    name: item.name, set: item.set.name, img: item.images.small,
                    condition: 'NM', raw: rawPrice, fee: 15, target: 10,
                    psa10: parseFloat((rawPrice * 3.2).toFixed(2)),
                    psa9: parseFloat((rawPrice * 1.1).toFixed(2)),
                    psa8: parseFloat((rawPrice * 0.85).toFixed(2)),
                    sentDate: '', owner: '', finalGrade: ''
                };
                this.cards.push(newCard);
                this.save();
                this.showSearch = false;
            },
            
            remove(i) { if(confirm('Remove Asset?')) { this.cards.splice(i,1); this.save(); } },
            
            exportExcel() {
                const data = this.cards.map(c => ({
                    Card: c.name, Set: c.set, Raw: c.raw, Cost: c.fee, 
                    Grade: c.target, PSA10: c.psa10, PSA9: c.psa9, PSA8: c.psa8,
                    Profit: this.getProfit(c), Decision: this.getProfit(c) > 0 ? "YES" : "NO"
                }));
                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Gladiator Data");
                XLSX.writeFile(wb, "Gladiator_Export.xlsx");
            },
            
            exportPDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                doc.setFont("helvetica", "bold"); doc.text("GLADIATOR REPORT", 14, 20);
                
                const rows = this.cards.map(c => [
                    c.name, `$${c.raw}`, `$${c.fee}`, c.target, 
                    `$${this.getProfit(c).toFixed(0)}`, this.getProfit(c) > 0 ? "YES" : "NO"
                ]);
                
                doc.autoTable({
                    startY: 30, head: [['Card', 'Raw', 'Cost', 'Grd', 'Profit', 'Dec']],
                    body: rows, theme: 'grid', styles: { fontSize: 8 },
                    headStyles: { fillColor: [212, 175, 55], textColor: [0,0,0] }
                });
                doc.save("Gladiator_Report.pdf");
            },

            backup() {
                const blob = new Blob([JSON.stringify(this.cards)], {type: "application/json"});
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob); a.download = "gladiator_backup.json";
                a.click();
            },
            restore(e) {
                const reader = new FileReader();
                reader.onload = e => { this.cards = JSON.parse(e.target.result); this.save(); };
                reader.readAsText(e.target.files[0]);
            }
        }
    }).mount('#app');
</script>
</body>
</html>

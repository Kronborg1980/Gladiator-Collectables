<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gladiator | Pro Ecosystem</title>
<link rel="icon" type="image/webp" href="https://raw.githubusercontent.com/Kronborg1980/Gladiator-Collectables/main/logogla.webp">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<style>
  :root { --accent: #00f2ff; --bg-dark: #020408; --glass-surface: rgba(10,15,25,0.85); --glass-edge: rgba(0,242,255,0.15); }
  body { font-family: 'Inter', sans-serif; background-color: var(--bg-dark); color: #fff; min-height: 100vh; overflow-y: auto; }
  @media (min-width: 768px) { body { height: 100vh; overflow: hidden; } }
  .font-brand { font-family: 'Cinzel', serif; }
  [v-cloak] { display: none; }
  .glass-panel { background: var(--glass-surface); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); border: 1px solid var(--glass-edge); box-shadow: 0 10px 40px rgba(0,0,0,0.6); border-radius: 16px; }
  .table-input { background: transparent; border-bottom: 1px solid rgba(255,255,255,0.15); color: #fff; text-align: right; width: 100%; outline: none; font-size: 12px; padding-bottom: 2px; }
  .table-input:focus { border-bottom-color: var(--accent); color: var(--accent); }
  .custom-checkbox { appearance: none; background:#000; width: 14px; height: 14px; border: 1px solid #555; border-radius: 3px; display: grid; place-content: center; cursor: pointer; }
  .custom-checkbox::before { content: ""; width: 8px; height: 8px; transform: scale(0); transition: 120ms; box-shadow: inset 1em 1em var(--accent); clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%); }
  .custom-checkbox:checked::before { transform: scale(1); }
  .custom-checkbox:checked { border-color: var(--accent); }
</style>
</head>
<body class="p-4">

<div id="app" v-cloak>
  <aside :class="['fixed inset-0 z-30 transition-all duration-300 glass-panel flex-col', isDesktop ? 'relative w-72' : (showMobileNav ? 'translate-x-0' : '-translate-x-full')]">
    <div class="p-8 text-center border-b border-white/5">
      <img src="https://raw.githubusercontent.com/Kronborg1980/Gladiator-Collectables/main/logogla.webp" class="w-12 h-12 mx-auto mb-3">
      <h1 class="text-xl font-brand font-bold text-white tracking-[0.2em]">GLADIATOR</h1>
      <div class="text-[10px] text-gray-400 uppercase tracking-widest mt-1">Portfolio Tracker</div>
    </div>
    <nav class="flex-1 overflow-y-auto py-6 px-4 space-y-1">
      <button @click="currentView='collection'; showMobileNav=false" class="w-full text-left px-4 py-3 text-sm text-gray-400 hover:bg-white/5 rounded" :class="{active: currentView==='collection'}">Collection</button>
      <button @click="currentView='calculator'; currentBinder=null; showMobileNav=false" class="w-full text-left px-4 py-3 text-sm text-gray-400 hover:bg-white/5 rounded" :class="{active: currentView==='calculator' && !currentBinder}">ROI Calculator (All)</button>
      <button @click="currentView='binders'; showMobileNav=false" class="w-full text-left px-4 py-3 text-sm text-gray-400 hover:bg-white/5 rounded" :class="{active: currentView==='binders'}">My Binders</button>
      <template v-for="binder in binders" :key="binder.id">
        <button @click="currentBinder=binder; currentView='calculator'; showMobileNav=false" class="w-full text-left px-4 py-2 text-sm text-gray-400 hover:bg-white/5 rounded flex justify-between items-center">
          <span>{{ binder.name }}</span>
          <i @click.stop="deleteBinder(binder.id)" class="fas fa-trash text-xs opacity-0 hover:opacity-100 hover:text-red-500"></i>
        </button>
      </template>
    </nav>
    <div class="p-6 border-t border-white/5">
      <button @click="createBinder" class="w-full bg-accent text-black font-bold py-3 rounded-lg">+ New Binder</button>
    </div>
  </aside>

  <main class="ml-0 md:ml-72 flex-1 flex flex-col">
    <header class="glass-panel p-6 flex justify-between items-center">
      <div>
        <h2 class="text-2xl font-brand font-bold">{{ currentBinder?.name || 'ROI Calculator' }}</h2>
        <p class="text-cyan-400">Total Value: ${{ Math.round(totalValue) }}</p>
      </div>
      <button @click="showSearch=true" class="bg-accent text-black font-bold px-6 py-3 rounded-lg">Add Card</button>
    </header>

    <div class="flex-1 glass-panel m-4 overflow-y-auto">
      <table class="w-full text-sm">
        <thead class="bg-white/5 text-xs uppercase text-gray-400">
          <tr>
            <th class="p-4 text-left">Card</th>
            <th class="p-4 text-right">Raw Cost</th>
            <th class="p-4 text-right">Fee</th>
            <th class="p-4 text-right">PSA10 Est.</th>
            <th class="p-4 text-right">Profit</th>
            <th class="p-4 text-center">Decision</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="c in displayCards" :key="c.uid" class="border-t border-white/5 hover:bg-white/5">
            <td class="p-4 flex items-center gap-4">
              <img :src="c.image" class="w-12 rounded">
              <div>
                <div class="font-bold">{{ c.name }}</div>
                <div class="text-xs text-gray-400">{{ c.set }}</div>
              </div>
            </td>
            <td class="p-4 text-right"><input v-model.number="c.rawCost" @change="saveCard(c)" type="number" class="table-input"></td>
            <td class="p-4 text-right"><input v-model.number="c.fee" @change="saveCard(c)" type="number" class="table-input"></td>
            <td class="p-4 text-right text-accent font-bold">${{ Math.round(c.market * 3.2) }}</td>
            <td class="p-4 text-right" :class="profit(c)>0?'text-green-400':'text-red-400'">{{ profit(c) }}</td>
            <td class="p-4 text-center">
              <span class="px-4 py-1 rounded-full text-xs font-bold" :class="profit(c)>100?'bg-green-900/50 text-green-300':'bg-red-900/50 text-red-300'">
                {{ profit(c)>100?'GRADE NOW':'HOLD' }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>

  <!-- Search Modal -->
  <div v-if="showSearch" class="fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-8">
    <div class="glass w-full max-w-4xl max-h-[90vh] overflow-y-auto rounded-2xl p-8">
      <input v-model="query" @keyup.enter="searchCards" placeholder="Search cards..." class="w-full p-4 rounded-xl bg-white/5 border border-white/10 focus:border-accent outline-none mb-6">
      <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6">
        <div v-for="c in searchResults" :key="c.id" @click="addCard(c)" class="cursor-pointer hover:ring-2 hover:ring-accent rounded-xl overflow-hidden">
          <img :src="c.images.small">
          <div class="p-3 bg-black/60">
            <p class="font-bold text-sm truncate">{{ c.name }}</p>
            <p class="text-xs text-cyan-400">${{ cardPrice(c) }}</p>
          </div>
        </div>
      </div>
      <button @click="showSearch=false" class="mt-6 text-gray-400">Close</button>
    </div>
  </div>
</div>

<script>
const firebaseConfig = {apiKey:"AIzaSyBnb9VlLk4sNbj89beWtb2hmLGsvhgb6TE",authDomain:"gladiator-portfolio.firebaseapp.com",projectId:"gladiator-portfolio",storageBucket:"gladiator-portfolio.firebasestorage.app",messagingSenderId:"61051937804",appId:"1:61051937804:web:535cbbcb5417c4bde67a29"};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const { createApp, ref, computed, onMounted } = Vue;

createApp({
  data() {
    return {
      user: null,
      cards: [],
      binders: [],
      currentBinder: null,
      currentView: 'calculator',
      showSearch: false,
      query: '',
      searchResults: [],
      showMobileNav: false,
      isDesktop: window.innerWidth >= 768  // ← THIS WAS THE BUG — NOW FIXED
    }
  },
  computed: {
    displayCards() {
      if (this.currentBinder) return this.cards.filter(c => c.binderId === this.currentBinder.id);
      return this.cards;
    },
    totalValue() {
      return this.cards.reduce((sum, c) => sum + (c.market || 0), 0);
    }
  },
  methods: {
    profit(c) { return Math.round(c.market * 3.2 - (c.rawCost || 0) - (c.fee || 0)); },
    cardPrice(c) {
      const p = c.tcgplayer?.prices;
      return p?.holofoil?.market || p?.normal?.market || 0;
    },
    async searchCards() {
      const res = await fetch(`https://api.pokemontcg.io/v2/cards?q=name:"*${this.query}*"&pageSize=48`, {
        headers: { 'X-Api-Key': '7191ffb5-91d7-4fb7-bc30-94f1b854ee6e' }
      });
      const data = await res.json();
      this.searchResults = data.data;
    },
    addCard(card) {
      const market = this.cardPrice(card);
      const newCard = {
        uid: Date.now().toString(),
        name: card.name,
        set: card.set.name,
        image: card.images.small,
        market: market,
        rawCost: market,
        fee: 20,
        binderId: this.currentBinder?.id || null
      };
      this.cards.push(newCard);
      if (this.user) {
        db.collection('users').doc(this.user.uid).collection('cards').add(newCard);
      }
      this.showSearch = false;
    },
    saveCard(c) {
      if (this.user) {
        db.collection('users').doc(this.user.uid).collection('cards').doc(c.uid).update({
          rawCost: c.rawCost, fee: c.fee
        });
      }
    },
    createBinder() {
      const name = prompt("Binder name:");
      if (name) {
        const binder = { id: Date.now().toString(), name };
        this.binders.push(binder);
        if (this.user) {
          db.collection('users').doc(this.user.uid).collection('binders').add(binder);
        }
      }
    },
    deleteBinder(id) {
      if (confirm("Delete binder?")) {
        this.binders = this.binders.filter(b => b.id !== id);
        this.cards.forEach(c => { if (c.binderId === id) c.binderId = null; });
      }
    }
  },
  mounted() {
    window.addEventListener('resize', () => {
      this.isDesktop = window.innerWidth >= 768;
    });
    auth.onAuthStateChanged(u => {
      this.user = u;
      if (u) {
        db.collection('users').doc(u.uid).collection('cards').onSnapshot(s => {
          this.cards = s.docs.map(d => ({uid: d.id, ...d.data()}));
        });
        db.collection('users').doc(u.uid).collection('binders').onSnapshot(s => {
          this.binders = s.docs.map(d => ({id: d.id, ...d.data()}));
        });
      }
    });
  }
}).mount('#app');
</script>
</body>
</html>

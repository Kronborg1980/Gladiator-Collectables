<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gladiator Collectibles - Analyzer</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        :root { --bg: #050505; --gold: #D4AF37; --panel: #111; }
        body { font-family: 'Lato', sans-serif; background: var(--bg); color: #e2e8f0; }
        h1, .brand { font-family: 'Cinzel', serif; }
        [v-cloak] { display: none; }
        
        /* Table Inputs */
        .table-input {
            background: transparent; border: 1px solid transparent; color: inherit; 
            width: 100%; text-align: right; padding: 4px; font-family: monospace; border-radius: 4px;
        }
        .table-input:hover { border-color: #333; background: #0a0a0a; }
        .table-input:focus { border-color: var(--gold); outline: none; background: #000; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        
        .gold-glow { text-shadow: 0 0 10px rgba(212, 175, 55, 0.3); }
    </style>
</head>
<body class="min-h-screen p-4">

<div id="app" v-cloak class="max-w-[1900px] mx-auto">
    
    <div class="flex flex-col md:flex-row justify-between items-end mb-6 border-b border-[#222] pb-4">
        <div>
            <h1 class="text-4xl font-bold text-[#D4AF37] uppercase tracking-wider gold-glow">
                <i class="fa-solid fa-helmet-safety mr-2"></i>Gladiator
            </h1>
            <p class="text-xs text-slate-500 tracking-[0.4em] uppercase">Grading Analyzer</p>
        </div>
        
        <div class="flex gap-8 mt-4 md:mt-0">
            <div class="text-right">
                <div class="text-[10px] uppercase text-slate-500">Cards Analyzed</div>
                <div class="text-2xl font-bold">{{ cards.length }}</div>
            </div>
            <div class="text-right">
                <div class="text-[10px] uppercase text-slate-500">Total Profit</div>
                <div class="text-2xl font-bold" :class="totalProfit >= 0 ? 'text-[#D4AF37]' : 'text-red-500'">
                    ${{ formatNumber(totalProfit) }}
                </div>
            </div>
        </div>
    </div>

    <div class="flex flex-wrap gap-4 mb-4 items-center bg-[#111] p-3 rounded border border-[#222]">
        <div class="relative flex-1 min-w-[200px]">
            <i class="fa-solid fa-search absolute left-3 top-2.5 text-slate-600"></i>
            <input v-model="filter" placeholder="FILTER YOUR LIST..." class="w-full bg-black border border-[#333] rounded py-2 pl-9 pr-4 text-xs font-bold uppercase focus:border-[#D4AF37] outline-none transition">
        </div>
        
        <div class="flex gap-2">
            <button @click="exportExcel" class="px-4 py-2 bg-[#1a1a1a] hover:bg-[#222] border border-[#333] text-green-500 text-[10px] font-bold uppercase rounded transition">
                <i class="fa-solid fa-file-excel mr-1"></i> Excel
            </button>
            <button @click="exportPDF" class="px-4 py-2 bg-[#1a1a1a] hover:bg-[#222] border border-[#333] text-red-500 text-[10px] font-bold uppercase rounded transition">
                <i class="fa-solid fa-file-pdf mr-1"></i> PDF
            </button>
            <button @click="backup" class="px-4 py-2 bg-[#1a1a1a] hover:bg-[#222] border border-[#333] text-blue-500 text-[10px] font-bold uppercase rounded transition">
                <i class="fa-solid fa-download mr-1"></i> Save
            </button>
            <label class="px-4 py-2 bg-[#1a1a1a] hover:bg-[#222] border border-[#333] text-purple-500 text-[10px] font-bold uppercase rounded transition cursor-pointer">
                <i class="fa-solid fa-upload mr-1"></i> Load
                <input type="file" @change="restore" class="hidden" accept=".json">
            </label>
            <button @click="openSearch" class="px-6 py-2 bg-[#D4AF37] hover:bg-white text-black font-bold text-xs uppercase rounded shadow-[0_0_15px_rgba(212,175,55,0.2)] transition">
                <i class="fa-solid fa-plus mr-1"></i> Add Card
            </button>
        </div>
    </div>

    <div class="bg-[#111] rounded border border-[#222] overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-black text-[#666] text-[10px] uppercase tracking-widest border-b border-[#222]">
                        <th class="p-3 w-12">Img</th>
                        <th class="p-3">Card Name</th>
                        <th class="p-3 text-right w-28">Raw Price</th>
                        <th class="p-3 text-right w-28">Grading Cost</th>
                        <th class="p-3 text-center w-24">Pre-Grade</th>
                        <th class="p-3 text-right w-24">Exp. Value</th>
                        <th class="p-3 text-center w-32">Decision</th>
                        <th class="p-3 text-right w-28">Profit</th>
                        <th class="p-3 w-10"></th>
                    </tr>
                </thead>
                <tbody class="text-sm divide-y divide-[#1a1a1a]">
                    <tr v-for="(c, i) in filteredCards" :key="i" class="hover:bg-[#161616] group transition-colors">
                        <td class="p-2">
                            <div class="w-8 h-10 bg-black rounded border border-[#333] overflow-hidden relative">
                                <img v-if="c.img" :src="c.img" class="absolute w-full h-full object-cover">
                            </div>
                        </td>
                        
                        <td class="p-3">
                            <div class="font-bold text-slate-200">{{ c.name }}</div>
                            <div class="text-[10px] text-slate-500 uppercase">{{ c.set }}</div>
                        </td>

                        <td class="p-2">
                            <input v-model.number="c.raw" @change="save" type="number" class="table-input text-slate-400">
                        </td>

                        <td class="p-2">
                            <input v-model.number="c.fee" @change="save" type="number" class="table-input text-slate-400">
                        </td>

                        <td class="p-2 text-center">
                            <select v-model="c.grade" @change="save" class="bg-transparent border border-transparent hover:border-[#333] text-[#D4AF37] font-bold text-xs p-1 rounded cursor-pointer outline-none">
                                <option value="10">PSA 10</option>
                                <option value="9">PSA 9</option>
                                <option value="8">PSA 8</option>
                            </select>
                        </td>

                        <td class="p-3 text-right font-mono text-xs text-slate-600">
                            ${{ formatNumber(getValue(c)) }}
                        </td>

                        <td class="p-3 text-center">
                            <div v-if="getProfit(c) > 0" class="inline-block px-3 py-1 bg-green-900/30 text-green-400 border border-green-900 rounded text-[10px] font-bold uppercase tracking-wider shadow-[0_0_10px_rgba(74,222,128,0.1)]">
                                <i class="fa-solid fa-check mr-1"></i> Grade It
                            </div>
                            <div v-else class="inline-block px-3 py-1 bg-red-900/30 text-red-400 border border-red-900 rounded text-[10px] font-bold uppercase tracking-wider">
                                <i class="fa-solid fa-xmark mr-1"></i> Don't
                            </div>
                        </td>

                        <td class="p-3 text-right font-mono font-bold text-base">
                            <span :class="getProfit(c) > 0 ? 'text-[#D4AF37]' : 'text-red-500'">
                                ${{ formatNumber(getProfit(c)) }}
                            </span>
                        </td>

                        <td class="p-3 text-center">
                            <button @click="remove(i)" class="text-slate-700 hover:text-red-500 transition opacity-0 group-hover:opacity-100">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div v-if="cards.length === 0" class="p-16 text-center text-slate-700">
            <i class="fa-solid fa-magnifying-glass-chart text-5xl mb-4 opacity-50"></i>
            <p class="uppercase text-xs tracking-widest">No cards in analyzer</p>
            <button @click="openSearch" class="mt-4 text-[#D4AF37] text-xs hover:underline">Add one now</button>
        </div>
    </div>

    <div v-if="showSearch" class="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-start justify-center pt-20 z-50 p-4">
        <div class="w-full max-w-3xl bg-[#111] border border-[#333] rounded-lg shadow-2xl flex flex-col max-h-[80vh]">
            
            <div class="p-4 border-b border-[#222] relative">
                <input ref="searchBox" v-model="query" type="text" placeholder="SEARCH DATABASE (e.g. Charizard 151)..." 
                    class="w-full bg-black border border-[#333] p-4 text-lg font-mono text-[#D4AF37] focus:border-[#D4AF37] rounded outline-none placeholder-slate-700">
                <button @click="showSearch=false" class="absolute right-6 top-6 text-slate-500 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
                
                <div class="flex justify-between mt-2 text-[10px] text-slate-500 uppercase tracking-wider">
                    <span>{{ loading ? 'Searching...' : 'Results: ' + results.length }}</span>
                    <span>Powered by PokemonTCG.io</span>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-4 bg-[#050505]">
                <div v-if="results.length > 0" class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                    <div v-for="item in results" :key="item.id" @click="add(item)" 
                         class="group cursor-pointer bg-[#111] border border-[#222] p-2 rounded hover:border-[#D4AF37] hover:bg-[#1a1a1a] transition relative">
                        <div class="aspect-[0.71] bg-black rounded overflow-hidden relative mb-2">
                            <img :src="item.images.small" loading="lazy" class="w-full h-full object-cover">
                        </div>
                        <div class="font-bold text-xs text-slate-300 truncate">{{ item.name }}</div>
                        <div class="text-[9px] text-slate-500 uppercase truncate">{{ item.set.name }}</div>
                        <div class="absolute top-2 right-2 bg-black/80 text-[#D4AF37] text-[10px] px-1 rounded font-mono">
                            ${{ getPrice(item) }}
                        </div>
                    </div>
                </div>
                <div v-else-if="!loading && query.length > 2" class="text-center py-10 text-slate-600 text-xs uppercase">
                    No results found
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                cards: [],
                filter: '',
                showSearch: false,
                query: '',
                results: [],
                loading: false,
                timer: null
            }
        },
        mounted() {
            const db = localStorage.getItem('gladiator_v11');
            if(db) this.cards = JSON.parse(db);
        },
        computed: {
            filteredCards() {
                if(!this.filter) return this.cards;
                return this.cards.filter(c => c.name.toLowerCase().includes(this.filter.toLowerCase()));
            },
            totalProfit() {
                return this.cards.reduce((sum, c) => sum + this.getProfit(c), 0);
            }
        },
        watch: {
            query(val) {
                clearTimeout(this.timer);
                if(val.length < 3) { this.results = []; return; }
                this.loading = true;
                this.timer = setTimeout(() => this.fetchAPI(val), 500);
            }
        },
        methods: {
            formatNumber(n) { return (n||0).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2}); },
            save() { localStorage.setItem('gladiator_v11', JSON.stringify(this.cards)); },
            
            // MATH
            getValue(c) {
                if(c.grade == 10) return c.val10;
                if(c.grade == 9) return c.val9;
                return c.val8;
            },
            getProfit(c) {
                return this.getValue(c) - (c.raw + c.fee);
            },

            // SEARCH API
            async fetchAPI(q) {
                try {
                    const clean = q.replace(/[^a-zA-Z0-9 ]/g, '');
                    const res = await fetch(`https://api.pokemontcg.io/v2/cards?q=name:"${clean}*"&orderBy=-set.releaseDate&pageSize=20`);
                    const data = await res.json();
                    this.results = data.data || [];
                } catch(e) {} finally { this.loading = false; }
            },
            getPrice(item) {
                if(item.tcgplayer?.prices) {
                    const p = item.tcgplayer.prices;
                    return p.holofoil?.market || p.normal?.market || p.reverseHolofoil?.market || 0;
                }
                return 0;
            },

            // ACTIONS
            openSearch() { 
                this.showSearch = true; 
                this.query = ''; 
                this.results = [];
                this.$nextTick(() => this.$refs.searchBox.focus());
            },
            add(item) {
                const price = this.getPrice(item);
                const newCard = {
                    name: item.name,
                    set: item.set.name,
                    img: item.images.small,
                    raw: price,
                    fee: 15, // Default Grading Cost
                    grade: 10, // Default Pre-Grade
                    // Algorithms for estimated graded value
                    val10: parseFloat((price * 3.2).toFixed(2)),
                    val9: parseFloat((price * 1.1).toFixed(2)),
                    val8: parseFloat((price * 0.8).toFixed(2))
                };
                this.cards.push(newCard);
                this.save();
                this.showSearch = false;
            },
            remove(i) {
                if(confirm('Remove this card?')) {
                    this.cards.splice(i,1);
                    this.save();
                }
            },

            // EXPORT / IMPORT
            exportExcel() {
                const data = this.cards.map(c => ({
                    Name: c.name, Set: c.set, Raw_Price: c.raw, Grade_Cost: c.fee,
                    Pre_Grade: c.grade, Est_Value: this.getValue(c), 
                    Profit: this.getProfit(c), Should_Grade: this.getProfit(c) > 0 ? "YES" : "NO"
                }));
                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Analysis");
                XLSX.writeFile(wb, "Gladiator_Analysis.xlsx");
            },
            exportPDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                doc.text("GLADIATOR GRADING ANALYSIS", 14, 20);
                const rows = this.cards.map(c => [
                    c.name, `$${c.raw}`, `$${c.fee}`, c.grade, 
                    `$${this.getProfit(c).toFixed(2)}`, this.getProfit(c) > 0 ? "YES" : "NO"
                ]);
                doc.autoTable({
                    startY: 30, head: [['Card', 'Raw', 'Fee', 'Grd', 'Profit', 'Decision']],
                    body: rows, theme: 'grid'
                });
                doc.save("Gladiator_Report.pdf");
            },
            backup() {
                const blob = new Blob([JSON.stringify(this.cards)], {type: "application/json"});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = "gladiator_backup.json";
                a.click();
            },
            restore(e) {
                const reader = new FileReader();
                reader.onload = e => {
                    this.cards = JSON.parse(e.target.result);
                    this.save();
                };
                reader.readAsText(e.target.files[0]);
            }
        }
    }).mount('#app');
</script>
</body>
</html>
